<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">

  <title>Solid Type System vs Runtime Checks and Unit Tests</title>

  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

  <link rel="stylesheet" href="css/reveal.css">
  <link rel="stylesheet" href="css/theme/night.css" id="theme">

  <!-- Code syntax highlighting -->
  <link rel="stylesheet" href="lib/css/zenburn.css">

  <link rel="stylesheet" href="css/custom.css">
  <!-- Printing and PDF exports -->
  <script>
    var link = document.createElement('link');
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
    document.getElementsByTagName('head')[0].appendChild(link);
  </script>

  <!--[if lt IE 9]>
  <script src="lib/js/html5shiv.js"></script>
  <![endif]-->
</head>

<body>

<div class="reveal">

  <!-- Any section element inside of this container is displayed as a slide -->
  <div class="slides">
    <section>
      <h2>Solid Type System</h2>
      <h3 class="fragment roll-in">vs</h3>
      <h2 class="fragment roll-in">Runtime Checks and Unit Tests</h2>
      <p class="fragment roll-in">Vladimir Pavkin</p>
    </section>

    <section>
      <h2>Plan</h2>
      <ul>
        <li class="fragment roll-in">Fail Fast concept</li>
        <li class="fragment roll-in">Scala Type System (in brief)</li>
        <li class="fragment roll-in">Type Safe Patterns</li>
      </ul>
    </section>
    <section>
      <h1>Fail Fast</h1>
      <img class="fragment roll-in" src="img/fail_fast.gif"/>
    </section>
    <section>
      <h1>Immediate and visible failure</h1>
    </section>
    <section>
      <h1>Where can it fail?</h1>
      <ul>
        <li class="hidden">Compiler</li>
        <li class="hidden">Linters</li>
        <li class="hidden">Unit tests</li>
        <li class="hidden">Runtime checks</li>
        <li class="highlight-orange fragment fade-in" data-fragment-index="2">Handled runtime exceptions & assertions</li>
        <li class="highlight-red1 fragment fade-in" data-fragment-index="1">Unhandled runtime failure</li>
      </ul>
    </section>
    <section>
      <h2 class="highlight-orange">Handling runtime exceptions</h2>
        <pre>
          <code data-trim class="scala big-code">
            assert(!list.isEmpty, "List must be empty")
          </code>
        </pre>
        <pre class="fragment roll-in">
          <code data-trim class="scala big-code">
try {
  str.toInt
} catch {
  case _:Throwable => 0
}
          </code>
        </pre>
    </section>
    <section>
      <h1>Where can it fail?</h1>
      <ul>
        <li class="hidden">Compiler</li>
        <li class="hidden">Linters</li>
        <li class="hidden">Unit tests</li>
        <li class="highlight-yellow fragment fade-in" data-fragment-index="1">Runtime checks</li>
        <li class="highlight-orange">Handled runtime exceptions & assertions</li>
        <li class="highlight-red1">Unhandled runtime failure</li>
      </ul>
    </section>
    <section>
      <h2 class="highlight-yellow">Runtime checks</h2>
      <pre>
        <code data-trim class="scala big-code">
          if(container == null)
        </code>
      </pre>
      <pre class="fragment roll-in">
        <code data-trim class="scala big-code">
          if(container.isInstanceOf[ContainerA])
        </code>
      </pre>
    </section>
    <section>
      <h1>Where can it fail?</h1>
      <ul>
        <li class="hidden">Compiler</li>
        <li class="hidden">Linters</li>
        <li class="highlight-aqua fragment fade-in" data-fragment-index="2">Unit tests</li>
        <li class="highlight-yellow">Runtime checks</li>
        <li class="highlight-orange">Handled runtime exceptions & assertions</li>
        <li class="highlight-red1">Unhandled runtime failure</li>
      </ul>
    </section>
    <section>
      <h2 class="highlight-aqua">Unit tests</h2>
      <pre>
        <code data-trim class="scala medium-code">
it should "throw NoSuchElementException for empty stack" in {
  val emptyStack = new Stack[Int]
  a [NoSuchElementException] should be thrownBy {
    emptyStack.pop()
  }
}
        </code>
      </pre>
      <pre class="fragment roll-in">
        <code data-trim class="scala medium-code">
it should "not throw for empty stack" in {
  val stackWrapper = StackWrapper(new Stack[Int])
  noException should be thrownBy stackWrapper.pop()
}
        </code>
      </pre>
    </section>
    <section>
      <h1>Where can it fail?</h1>
      <ul>
        <li class="hidden">Compiler</li>
        <li class="highlight-aqua fragment fade-in" data-fragment-index="1">Linters</li>
        <li class="highlight-aqua">Unit tests</li>
        <li class="highlight-yellow">Runtime checks</li>
        <li class="highlight-orange">Handled runtime exceptions & assertions</li>
        <li class="highlight-red1">Unhandled runtime failure</li>
      </ul>
    </section>
    <section>
      <h2 class="highlight-aqua">Linters</h2>
         <pre>
           <code data-trim class="scala medium-code">
scalacOptions ++= Seq(
  "-Xlint",
  "-deprecation",
  "-Xfatal-warnings"
)
           </code>
         </pre>
         <pre class="fragment roll-in">
           <code data-trim class="scala medium-code">
// Wrong number of args to format()
logger.error(
  "Failed to open %s. Error: %d"
  .format(file)
)
           </code>
         </pre>
    </section>
    <section>
      <h1>Where can it fail?</h1>
      <ul>
        <li class="highlight-green1 fragment fade-in" data-fragment-index="1">Compiler</li>
        <li class="highlight-aqua">Linters</li>
        <li class="highlight-aqua">Unit tests</li>
        <li class="highlight-yellow">Runtime checks</li>
        <li class="highlight-orange">Handled runtime exceptions & assertions</li>
        <li class="highlight-red1">Unhandled runtime failure</li>
      </ul>
    </section>
    <section>
      <h1>The goal</h1> <h2>To move as much as possible to the <span class="highlight-green1">Compiler</span></h2>
    </section>
    <section>
      <h1>How?</h1>
      <h2 class="fragment">Just give it <br/><span class="highlight-green1">enough type information.</span></h2>
      <h4 class="fragment">Type system to the rescue!</h4>
    </section>
    <section>
      <h2>Before we start...</h2>
      <h1 class=" fragment fade-in">Examples domain?</h1>
    </section>
    <section>
      <h1>Beefcakes!</h1>
      <img src="img/beefcakes.jpg" width="80%">
    </section>
    <section>
      <h2>Ok?</h2>
      <pre>
        <code data-trim class="scala big-code">
def becomeAMan(douchebag: Person): Man =
  new Man(douchebag.renameTo("Arny"))
        </code>
      </pre>
      <div class="fragment roll-in">
        <h2 class="highlight-red1">No! Unhandled runtime failure!</h2>
        <pre>
          <code data-trim class="scala big-code">
            becomeAMan(null)
          </code>
        </pre>
      </div>
    </section>
    <section>
      <h1 class="highlight-red1">NULL</h1>
      <img src="img/null.jpg">
    </section>
    <section>
      <h2>Maybe like this?</h2>
      <pre>
        <code data-trim class="scala big-code">
def becomeAMan(douchebag: Person): Man =
  if(douchebag != null)
    new Man(douchebag.renameTo("Arny"))
  else
    null
        </code>
      </pre>
    </section>
    <section>
      <h2 class="highlight-yellow">Still not nice.</h2>
      <ul>
        <li class="fragment roll-in">runtime check</li>
        <li class="fragment roll-in">code client doesn't expect <code class="highlight-aqua">null</code>...</li>
        <li class="fragment roll-in">... so now <span class="highlight-yellow">he</span> has to do <span class="highlight-yellow">runtime checks</span></li>
      </ul>
    </section>
    <section>
      <blockquote style="font-size: 150%; width: 100%">
        If you control the source code,<br/>
        don't ever use <code>null</code> as a return result.<br/>
        It's like farting in an elevator.
      </blockquote>
      <br/>
      <p style="text-align: right; color:gray;">Some random guy at a random Scala forum</p>
    </section>
    <section>
      <h3>The problem is</h3>
      <h2 class="fragment roll-in highlight-yellow">insufficient type information!</h2>
      <h3 class="fragment roll-in">Return type should be something like <code class="highlight-aqua">ManOrNull</code></h3>
    </section>
    <section>
      <h1 class="highlight-green1">Option</h1>
      <img src="img/option.jpg">
    </section>
    <section>
      <h2 class="highlight-green1">Option</h2>
      <pre>
        <code data-trim class="scala big-code">
sealed trait Option[T]
case class Some[T](x: T) extends Option[T]
case object None extends Option[Nothing]
        </code>
      </pre>
    </section>
  </div>

</div>

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>

<script>

  // Full list of configuration options available at:
  // https://github.com/hakimel/reveal.js#configuration
  Reveal.initialize({
    controls: true,
    progress: true,
    history: true,
    center: true,

    transition: 'slide', // none/fade/slide/convex/concave/zoom

    // Optional reveal.js plugins
    dependencies: [
      {
        src: 'lib/js/classList.js', condition: function() {
        return !document.body.classList;
      }
      },
      {
        src: 'plugin/markdown/marked.js', condition: function() {
        return !!document.querySelector('[data-markdown]');
      }
      },
      {
        src: 'plugin/markdown/markdown.js', condition: function() {
        return !!document.querySelector('[data-markdown]');
      }
      },
      {
        src: 'plugin/highlight/highlight.js', async: true, condition: function() {
        return !!document.querySelector('pre code');
      }, callback: function() {
        hljs.initHighlightingOnLoad();
      }
      },
      {src: 'plugin/zoom-js/zoom.js', async: true},
      {src: 'plugin/notes/notes.js', async: true}
    ]
  });

</script>

</body>
</html>
